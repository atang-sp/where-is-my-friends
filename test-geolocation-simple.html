<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocation API æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            max-width: 800px;
        }
        .result { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            border: 1px solid #ddd;
        }
        .success { 
            background-color: #d4edda; 
            color: #155724; 
            border-color: #c3e6cb; 
        }
        .error { 
            background-color: #f8d7da; 
            color: #721c24; 
            border-color: #f5c6cb; 
        }
        .info { 
            background-color: #d1ecf1; 
            color: #0c5460; 
            border-color: #bee5eb; 
        }
        button { 
            padding: 12px 24px; 
            margin: 10px 5px; 
            cursor: pointer; 
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { 
            background-color: #6c757d; 
            cursor: not-allowed; 
        }
        pre { 
            background-color: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto;
        }
        .loading { 
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>ğŸŒ æµè§ˆå™¨ Geolocation API æµ‹è¯•</h1>
    
    <div id="status" class="result info">
        <strong>çŠ¶æ€ï¼š</strong>æ­£åœ¨æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ...
    </div>
    
    <div>
        <button onclick="testBasicGeolocation()" id="basicBtn">
            åŸºç¡€åœ°ç†ä½ç½®æµ‹è¯•
        </button>
        <button onclick="testHighAccuracyGeolocation()" id="highAccuracyBtn">
            é«˜ç²¾åº¦åœ°ç†ä½ç½®æµ‹è¯•
        </button>
        <button onclick="testWithOptions()" id="optionsBtn">
            è‡ªå®šä¹‰é€‰é¡¹æµ‹è¯•
        </button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        let isSupported = false;
        
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = `<strong>çŠ¶æ€ï¼š</strong>${message}`;
            status.className = `result ${type}`;
        }
        
        function addResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(content, null, 2)}</pre>
            `;
            results.appendChild(div);
        }
        
        function setButtonLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (loading) {
                btn.innerHTML = '<span class="loading"></span> è·å–ä¸­...';
                btn.disabled = true;
            } else {
                btn.innerHTML = btn.getAttribute('data-original-text') || 'æµ‹è¯•';
                btn.disabled = false;
            }
        }
        
        function testBasicGeolocation() {
            if (!isSupported) {
                log('æµè§ˆå™¨ä¸æ”¯æŒ Geolocation API', 'error');
                return;
            }
            
            setButtonLoading('basicBtn', true);
            log('æ­£åœ¨è·å–åŸºç¡€åœ°ç†ä½ç½®...', 'info');
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    log('åŸºç¡€åœ°ç†ä½ç½®è·å–æˆåŠŸï¼', 'success');
                    addResult('åŸºç¡€åœ°ç†ä½ç½®ç»“æœ', {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy + ' ç±³',
                        timestamp: new Date(position.timestamp).toLocaleString(),
                        altitude: position.coords.altitude,
                        altitudeAccuracy: position.coords.altitudeAccuracy,
                        heading: position.coords.heading,
                        speed: position.coords.speed
                    }, 'success');
                    setButtonLoading('basicBtn', false);
                },
                function(error) {
                    const errorInfo = getErrorInfo(error);
                    log(`åŸºç¡€åœ°ç†ä½ç½®è·å–å¤±è´¥: ${errorInfo.message}`, 'error');
                    addResult('åŸºç¡€åœ°ç†ä½ç½®é”™è¯¯', errorInfo, 'error');
                    setButtonLoading('basicBtn', false);
                }
            );
        }
        
        function testHighAccuracyGeolocation() {
            if (!isSupported) {
                log('æµè§ˆå™¨ä¸æ”¯æŒ Geolocation API', 'error');
                return;
            }
            
            setButtonLoading('highAccuracyBtn', true);
            log('æ­£åœ¨è·å–é«˜ç²¾åº¦åœ°ç†ä½ç½®...', 'info');
            
            const options = {
                enableHighAccuracy: true,
                timeout: 30000,
                maximumAge: 0
            };
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    log('é«˜ç²¾åº¦åœ°ç†ä½ç½®è·å–æˆåŠŸï¼', 'success');
                    addResult('é«˜ç²¾åº¦åœ°ç†ä½ç½®ç»“æœ', {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy + ' ç±³',
                        timestamp: new Date(position.timestamp).toLocaleString(),
                        altitude: position.coords.altitude,
                        altitudeAccuracy: position.coords.altitudeAccuracy,
                        heading: position.coords.heading,
                        speed: position.coords.speed
                    }, 'success');
                    setButtonLoading('highAccuracyBtn', false);
                },
                function(error) {
                    const errorInfo = getErrorInfo(error);
                    log(`é«˜ç²¾åº¦åœ°ç†ä½ç½®è·å–å¤±è´¥: ${errorInfo.message}`, 'error');
                    addResult('é«˜ç²¾åº¦åœ°ç†ä½ç½®é”™è¯¯', errorInfo, 'error');
                    setButtonLoading('highAccuracyBtn', false);
                },
                options
            );
        }
        
        function testWithOptions() {
            if (!isSupported) {
                log('æµè§ˆå™¨ä¸æ”¯æŒ Geolocation API', 'error');
                return;
            }
            
            setButtonLoading('optionsBtn', true);
            log('æ­£åœ¨ä½¿ç”¨è‡ªå®šä¹‰é€‰é¡¹è·å–åœ°ç†ä½ç½®...', 'info');
            
            const options = {
                enableHighAccuracy: false,
                timeout: 30000,
                maximumAge: 300000 // 5åˆ†é’Ÿç¼“å­˜
            };
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    log('è‡ªå®šä¹‰é€‰é¡¹åœ°ç†ä½ç½®è·å–æˆåŠŸï¼', 'success');
                    addResult('è‡ªå®šä¹‰é€‰é¡¹åœ°ç†ä½ç½®ç»“æœ', {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy + ' ç±³',
                        timestamp: new Date(position.timestamp).toLocaleString(),
                        options: options
                    }, 'success');
                    setButtonLoading('optionsBtn', false);
                },
                function(error) {
                    const errorInfo = getErrorInfo(error);
                    log(`è‡ªå®šä¹‰é€‰é¡¹åœ°ç†ä½ç½®è·å–å¤±è´¥: ${errorInfo.message}`, 'error');
                    addResult('è‡ªå®šä¹‰é€‰é¡¹åœ°ç†ä½ç½®é”™è¯¯', errorInfo, 'error');
                    setButtonLoading('optionsBtn', false);
                },
                options
            );
        }
        
        function getErrorInfo(error) {
            let message = '';
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    message = 'ä½ç½®è®¿é—®è¢«æ‹’ç»';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'ä½ç½®ä¿¡æ¯ä¸å¯ç”¨';
                    break;
                case error.TIMEOUT:
                    message = 'ä½ç½®è¯·æ±‚è¶…æ—¶';
                    break;
                default:
                    message = 'æœªçŸ¥é”™è¯¯';
            }
            
            return {
                code: error.code,
                message: message,
                details: error.message,
                timestamp: new Date().toLocaleString()
            };
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            log('ç»“æœå·²æ¸…é™¤', 'info');
        }
        
        // ä¿å­˜æŒ‰é’®åŸå§‹æ–‡æœ¬
        function saveButtonTexts() {
            document.getElementById('basicBtn').setAttribute('data-original-text', 'åŸºç¡€åœ°ç†ä½ç½®æµ‹è¯•');
            document.getElementById('highAccuracyBtn').setAttribute('data-original-text', 'é«˜ç²¾åº¦åœ°ç†ä½ç½®æµ‹è¯•');
            document.getElementById('optionsBtn').setAttribute('data-original-text', 'è‡ªå®šä¹‰é€‰é¡¹æµ‹è¯•');
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ”¯æŒ
        window.onload = function() {
            saveButtonTexts();
            
            if (navigator.geolocation) {
                isSupported = true;
                log('âœ… æµè§ˆå™¨æ”¯æŒ Geolocation API', 'success');
                addResult('æµè§ˆå™¨ä¿¡æ¯', {
                    userAgent: navigator.userAgent,
                    geolocation: 'supported',
                    timestamp: new Date().toLocaleString()
                }, 'info');
            } else {
                isSupported = false;
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ Geolocation API', 'error');
                addResult('æµè§ˆå™¨ä¿¡æ¯', {
                    userAgent: navigator.userAgent,
                    geolocation: 'not supported',
                    timestamp: new Date().toLocaleString()
                }, 'error');
            }
        };
    </script>
</body>
</html> 